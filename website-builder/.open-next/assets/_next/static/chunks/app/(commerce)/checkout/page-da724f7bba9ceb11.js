(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[106],{1659:(e,t,a)=>{"use strict";a.d(t,{CheckoutPageClient:()=>n});var r=a(5155),s=a(2115),i=a(63),o=a(4995),c=a(8291);function n(e){let{businessProfile:t}=e,a=(0,i.useRouter)(),{cart:n,isLoading:l}=(0,o._)(),[d,m]=(0,s.useState)(0),[u,p]=(0,s.useState)(!1),[h,y]=(0,s.useState)({customer:{name:"",email:"",phone:"",address:"",city:"",state:"",zip_code:""},installation:{preferred_date:"",preferred_time:"morning",special_instructions:"",access_instructions:""},membership_type:"none",payment_method:"card",notes:"",terms_accepted:!1,email_consent:!0,sms_consent:!1}),[g,f]=(0,s.useState)([{id:"customer",title:"Customer Info",description:"Contact & address details",isComplete:!1,isActive:!0},{id:"installation",title:"Installation",description:"Schedule your installation",isComplete:!1,isActive:!1},{id:"payment",title:"Payment",description:"Payment method selection",isComplete:!1,isActive:!1},{id:"review",title:"Review",description:"Confirm your order",isComplete:!1,isActive:!1}]),[x,v]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(!l&&(!n||0===n.item_count)){v(!0);let e=setTimeout(()=>{a.push("/cart")},3e3);return()=>clearTimeout(e)}},[n,l,a]);let _=()=>{let e={};switch(d){case 0:h.customer.name.trim()||(e.name="Name is required"),h.customer.email.trim()||(e.email="Email is required"),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(h.customer.email)||(e.email="Valid email is required"),h.customer.phone.trim()||(e.phone="Phone number is required"),h.customer.address.trim()||(e.address="Address is required"),h.customer.city.trim()||(e.city="City is required"),h.customer.state.trim()||(e.state="State is required"),h.customer.zip_code.trim()||(e.zip_code="ZIP code is required");break;case 1:h.installation.preferred_date||(e.preferred_date="Installation date is required");break;case 2:h.payment_method||(e.payment_method="Payment method is required");break;case 3:h.terms_accepted||(e.terms_accepted="You must accept the terms and conditions")}return{isValid:0===Object.keys(e).length,errors:e}},E=()=>{if(!_().isValid)return;let e=[...g];e[d].isComplete=!0,e[d].isActive=!1,d<g.length-1&&(e[d+1].isActive=!0,m(d+1)),f(e)},b=()=>{if(d>0){let e=[...g];e[d].isActive=!1,e[d-1].isActive=!0,e[d-1].isComplete=!1,m(d-1),f(e)}},w=async()=>{if((null==n?void 0:n.id)&&_().isValid){p(!0);try{let e=(0,c.wE)(),r=await fetch("".concat(e,"/api/v1/public/contractors/").concat(t.business_id,"/checkout/process"),{method:"POST",headers:(0,c.KZ)(),body:JSON.stringify({cart_id:n.id,customer:h.customer,installation:h.installation,membership_type:h.membership_type,payment_method:h.payment_method,notes:h.notes})});if(!r.ok)throw Error("Checkout failed: ".concat(r.status));let s=await r.json();a.push("/checkout/success?estimate=".concat(s.estimate_number,"&booking=").concat(s.booking_number,"&total=").concat(s.total_amount))}catch(e){alert("Checkout failed. Please try again or contact support.")}finally{p(!1)}}};return l?(0,r.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-16",children:(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-md p-8",children:(0,r.jsxs)("div",{className:"animate-pulse space-y-6",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"h-12 bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-12 bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-12 bg-gray-200 rounded"})]})]})})}):x&&(!n||0===n.item_count)?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-16",children:(0,r.jsx)("div",{className:"max-w-2xl mx-auto px-4 text-center",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 mx-auto bg-gray-100 rounded-full flex items-center justify-center mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1 5a1 1 0 001 1h9M9 19v1a1 1 0 001 1h4a1 1 0 001-1v-1m-6 0a1 1 0 011-1h4a1 1 0 011 1m-6 0h6"})})}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Your Cart is Empty"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"You need to add items to your cart before you can proceed to checkout."}),(0,r.jsx)("div",{className:"text-sm text-gray-500 mb-6",children:"Redirecting to cart in 3 seconds..."})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("button",{onClick:()=>a.push("/products"),className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"Browse Products"}),(0,r.jsx)("button",{onClick:()=>a.push("/cart"),className:"w-full bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-3 rounded-lg font-medium transition-colors",children:"Go to Cart"})]})]})})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto px-4",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Secure Checkout"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:"Complete your order and schedule installation"})]}),(0,r.jsx)(CheckoutProgress,{steps:g,currentStep:d}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mt-8",children:[(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-md",children:(()=>{let e={formData:h,setFormData:y,validation:_(),onNext:E,onPrevious:d>0?b:void 0};switch(d){case 0:return(0,r.jsx)(CustomerInfoStep,{...e});case 1:return(0,r.jsx)(InstallationStep,{...e});case 2:return(0,r.jsx)(PaymentStep,{...e});case 3:return n?(0,r.jsx)(ReviewStep,{...e,cart:n,businessProfile:t,onSubmit:w,isProcessing:u}):null;default:return null}})()})}),(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsx)("div",{className:"sticky top-8",children:(0,r.jsx)(CheckoutSummary,{cart:n,membershipType:h.membership_type,businessProfile:t})})})]})]})})}},4995:(e,t,a)=>{"use strict";a.d(t,{CartProvider:()=>l,_:()=>d});var r=a(5155),s=a(2115),i=a(8291);let o={cart:null,cartSummary:null,isLoading:!1,error:null};function c(e,t){switch(t.type){case"SET_LOADING":return{...e,isLoading:t.payload};case"SET_ERROR":return{...e,error:t.payload,isLoading:!1};case"SET_CART":return{...e,cart:t.payload,error:null,isLoading:!1};case"SET_CART_SUMMARY":return{...e,cartSummary:t.payload};case"CLEAR_CART":return{...e,cart:null,cartSummary:null};default:return e}}let n=(0,s.createContext)(void 0);function l(e){let{children:t,businessId:a}=e,[l,d]=(0,s.useReducer)(c,o),m=(0,i.wE)(),u=()=>localStorage.getItem("cart_id"),p=()=>{localStorage.removeItem("cart_id")},h=async()=>{d({type:"SET_LOADING",payload:!0});try{var e;let t="session_".concat(Date.now()),r=await fetch("".concat(m,"/api/v1/public/contractors/shopping-cart/create?business_id=").concat(a,"&session_id=").concat(t),{method:"POST",headers:(0,i.KZ)()});if(!r.ok){let e=await r.text();throw Error("Failed to create cart: ".concat(r.status," ").concat(e))}let s=await r.json();if(!s||!s.id)throw Error("Invalid cart response: missing cart ID");e=s.id,localStorage.setItem("cart_id",e),d({type:"SET_CART",payload:s});try{await y(s.id)}catch(e){}}catch(t){let e=t instanceof Error?t.message:"Failed to create cart";throw d({type:"SET_ERROR",payload:e}),Error(e)}},y=async e=>{try{let t=await fetch("".concat(m,"/api/v1/public/contractors/shopping-cart/").concat(e,"/summary"),{headers:(0,i.KZ)()});if(t.ok){let e=await t.json();d({type:"SET_CART_SUMMARY",payload:e})}}catch(e){}},g=async()=>{let e=u();if(e){d({type:"SET_LOADING",payload:!0});try{let t=await fetch("".concat(m,"/api/v1/public/contractors/shopping-cart/").concat(e),{headers:(0,i.KZ)()});if(!t.ok){if(404===t.status){p(),d({type:"CLEAR_CART"});return}throw Error("Failed to fetch cart: ".concat(t.status," ").concat(t.statusText))}let a=await t.json();a.items&&a.items.length>0&&a.items.forEach((e,t)=>{}),d({type:"SET_CART",payload:a}),await y(e)}catch(e){d({type:"SET_ERROR",payload:e instanceof Error?e.message:"Failed to fetch cart"})}finally{d({type:"SET_LOADING",payload:!1})}}},f=async e=>{let t=u();if(!t)try{if(await h(),!(t=u()))throw Error("Cart creation succeeded but cart ID is still missing from localStorage")}catch(e){throw Error("Failed to create shopping cart: ".concat(e instanceof Error?e.message:"Unknown error"))}d({type:"SET_LOADING",payload:!0});try{let r=await fetch("".concat(m,"/api/v1/public/contractors/shopping-cart/").concat(t,"/items?business_id=").concat(a),{method:"POST",headers:(0,i.KZ)(),body:JSON.stringify(e)});if(!r.ok){let e=await r.text();throw Error("Failed to add item to cart: ".concat(r.status," ").concat(e))}await g()}catch(t){let e=t instanceof Error?t.message:"Failed to add item to cart";throw d({type:"SET_ERROR",payload:e}),Error(e)}},x=async(e,t)=>{let a=u();if(a){d({type:"SET_LOADING",payload:!0});try{let r=await fetch("".concat(m,"/api/v1/public/contractors/shopping-cart/").concat(a,"/items/").concat(e),{method:"PUT",headers:(0,i.KZ)(),body:JSON.stringify({quantity:t})});if(!r.ok){let e=await r.text();throw Error("Failed to update cart item: ".concat(r.status," ").concat(e))}await g()}catch(t){let e=t instanceof Error?t.message:"Failed to update cart item";throw d({type:"SET_ERROR",payload:e}),Error(e)}finally{d({type:"SET_LOADING",payload:!1})}}},v=async e=>{let t=u();if(t){d({type:"SET_LOADING",payload:!0});try{if(!(await fetch("".concat(m,"/api/v1/public/contractors/shopping-cart/").concat(t,"/items/").concat(e),{method:"DELETE",headers:(0,i.KZ)()})).ok)throw Error("Failed to remove item from cart");await g()}catch(e){d({type:"SET_ERROR",payload:e instanceof Error?e.message:"Failed to remove item"})}}},_=async()=>{let e=u();if(e){d({type:"SET_LOADING",payload:!0});try{if(!(await fetch("".concat(m,"/api/v1/public/contractors/shopping-cart/").concat(e),{method:"DELETE",headers:(0,i.KZ)()})).ok)throw Error("Failed to clear cart");p(),d({type:"CLEAR_CART"})}catch(e){d({type:"SET_ERROR",payload:e instanceof Error?e.message:"Failed to clear cart"})}}};(0,s.useEffect)(()=>{u()&&g()},[a]);let E={cart:l.cart,cartSummary:l.cartSummary,isLoading:l.isLoading,error:l.error,createCart:h,addToCart:f,updateCartItem:x,removeFromCart:v,clearCart:_,refreshCart:g};return(0,r.jsx)(n.Provider,{value:E,children:t})}function d(){let e=(0,s.useContext)(n);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},5151:(e,t,a)=>{"use strict";a.d(t,{default:()=>o});var r=a(5155);a(2115);var s=a(4995),i=a(9968);function o(e){let{businessId:t,services:a,companyName:o,companyPhone:c,companyEmail:n,children:l}=e;return(0,r.jsx)(s.CartProvider,{businessId:t,children:(0,r.jsx)(i.Hero365BookingProvider,{businessId:t,services:a,companyName:o,companyPhone:c,companyEmail:n,children:l})})}},6508:(e,t,a)=>{Promise.resolve().then(a.bind(a,1659)),Promise.resolve().then(a.bind(a,5151)),Promise.resolve().then(a.t.bind(a,2619,23))}},e=>{e.O(0,[96,968,358],()=>e(e.s=6508)),_N_E=e.O()}]);