(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{4586:(e,t,s)=>{"use strict";s.d(t,{CheckoutPageClient:()=>n});var i=s(5155),r=s(2115),a=s(63),o=s(577),c=s(607);function n(e){let{businessProfile:t}=e,s=(0,a.useRouter)(),{cart:n,isLoading:l}=(0,o._)(),[d,m]=(0,r.useState)(0),[u,h]=(0,r.useState)(!1),[p,x]=(0,r.useState)({customer:{name:"",email:"",phone:"",address:"",city:"",state:"",zip_code:""},installation:{preferred_date:"",preferred_time:"morning",special_instructions:"",access_instructions:""},membership_type:"none",payment_method:"card",notes:"",terms_accepted:!1,email_consent:!0,sms_consent:!1}),[y,g]=(0,r.useState)([{id:"customer",title:"Customer Info",description:"Contact & address details",isComplete:!1,isActive:!0},{id:"installation",title:"Installation",description:"Schedule your installation",isComplete:!1,isActive:!1},{id:"payment",title:"Payment",description:"Payment method selection",isComplete:!1,isActive:!1},{id:"review",title:"Review",description:"Confirm your order",isComplete:!1,isActive:!1}]),[b,v]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(!l&&(!n||0===n.item_count)){v(!0);let e=setTimeout(()=>{s.push("/cart")},3e3);return()=>clearTimeout(e)}},[n,l,s]);let j=()=>{let e={};switch(d){case 0:p.customer.name.trim()||(e.name="Name is required"),p.customer.email.trim()||(e.email="Email is required"),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p.customer.email)||(e.email="Valid email is required"),p.customer.phone.trim()||(e.phone="Phone number is required"),p.customer.address.trim()||(e.address="Address is required"),p.customer.city.trim()||(e.city="City is required"),p.customer.state.trim()||(e.state="State is required"),p.customer.zip_code.trim()||(e.zip_code="ZIP code is required");break;case 1:p.installation.preferred_date||(e.preferred_date="Installation date is required");break;case 2:p.payment_method||(e.payment_method="Payment method is required");break;case 3:p.terms_accepted||(e.terms_accepted="You must accept the terms and conditions")}return{isValid:0===Object.keys(e).length,errors:e}},N=()=>{if(!j().isValid)return;let e=[...y];e[d].isComplete=!0,e[d].isActive=!1,d<y.length-1&&(e[d+1].isActive=!0,m(d+1)),g(e)},_=()=>{if(d>0){let e=[...y];e[d].isActive=!1,e[d-1].isActive=!0,e[d-1].isComplete=!1,m(d-1),g(e)}},f=async()=>{if((null==n?void 0:n.id)&&j().isValid){h(!0);try{let e=(0,c.wE)(),i=await fetch("".concat(e,"/api/v1/public/contractors/").concat(t.business_id,"/checkout/process"),{method:"POST",headers:(0,c.KZ)(),body:JSON.stringify({cart_id:n.id,customer:p.customer,installation:p.installation,membership_type:p.membership_type,payment_method:p.payment_method,notes:p.notes})});if(!i.ok)throw Error("Checkout failed: ".concat(i.status));let r=await i.json();s.push("/checkout/success?estimate=".concat(r.estimate_number,"&booking=").concat(r.booking_number,"&total=").concat(r.total_amount))}catch(e){alert("Checkout failed. Please try again or contact support.")}finally{h(!1)}}};return l?(0,i.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-16",children:(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-md p-8",children:(0,i.jsxs)("div",{className:"animate-pulse space-y-6",children:[(0,i.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,i.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("div",{className:"h-12 bg-gray-200 rounded"}),(0,i.jsx)("div",{className:"h-12 bg-gray-200 rounded"}),(0,i.jsx)("div",{className:"h-12 bg-gray-200 rounded"})]})]})})}):b&&(!n||0===n.item_count)?(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 py-16",children:(0,i.jsx)("div",{className:"max-w-2xl mx-auto px-4 text-center",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8",children:[(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("div",{className:"w-16 h-16 mx-auto bg-gray-100 rounded-full flex items-center justify-center mb-4",children:(0,i.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1 5a1 1 0 001 1h9M9 19v1a1 1 0 001 1h4a1 1 0 001-1v-1m-6 0a1 1 0 011-1h4a1 1 0 011 1m-6 0h6"})})}),(0,i.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Your Cart is Empty"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"You need to add items to your cart before you can proceed to checkout."}),(0,i.jsx)("div",{className:"text-sm text-gray-500 mb-6",children:"Redirecting to cart in 3 seconds..."})]}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("button",{onClick:()=>s.push("/products"),className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"Browse Products"}),(0,i.jsx)("button",{onClick:()=>s.push("/cart"),className:"w-full bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-3 rounded-lg font-medium transition-colors",children:"Go to Cart"})]})]})})}):(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,i.jsxs)("div",{className:"max-w-6xl mx-auto px-4",children:[(0,i.jsxs)("div",{className:"text-center mb-8",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Secure Checkout"}),(0,i.jsx)("p",{className:"text-gray-600 mt-2",children:"Complete your order and schedule installation"})]}),(0,i.jsx)(CheckoutProgress,{steps:y,currentStep:d}),(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mt-8",children:[(0,i.jsx)("div",{className:"lg:col-span-2",children:(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-md",children:(()=>{let e={formData:p,setFormData:x,validation:j(),onNext:N,onPrevious:d>0?_:void 0};switch(d){case 0:return(0,i.jsx)(CustomerInfoStep,{...e});case 1:return(0,i.jsx)(InstallationStep,{...e});case 2:return(0,i.jsx)(PaymentStep,{...e});case 3:return n?(0,i.jsx)(ReviewStep,{...e,cart:n,businessProfile:t,onSubmit:f,isProcessing:u}):null;default:return null}})()})}),(0,i.jsx)("div",{className:"lg:col-span-1",children:(0,i.jsx)("div",{className:"sticky top-8",children:(0,i.jsx)(CheckoutSummary,{cart:n,membershipType:p.membership_type,businessProfile:t})})})]})]})})}},5635:(e,t,s)=>{Promise.resolve().then(s.bind(s,4586)),Promise.resolve().then(s.bind(s,5581)),Promise.resolve().then(s.bind(s,6649)),Promise.resolve().then(s.bind(s,1915)),Promise.resolve().then(s.bind(s,577))}},e=>{e.O(0,[96,408,141,962,915,358],()=>e(e.s=5635)),_N_E=e.O()}]);